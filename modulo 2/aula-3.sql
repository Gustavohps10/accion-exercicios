CREATE TABLE CATEGORIA_PRODUTO(
CATEGORIAPRODUTOID      SERIAL         NOT NULL,
DS_CATEGORIA_PRODUTO    VARCHAR(50)     NOT NULL,
PRIMARY KEY (CATEGORIAPRODUTOID)
);

CREATE TABLE CLIENTE(
CLIENTEID              SERIAL         NOT NULL,
TIPO_CLIENTE           CHAR(1)         NOT NULL,
CPF_CNPJ_CLIENTE       VARCHAR(18)     NOT NULL,
NOME_CLIENTE           VARCHAR(100)    NOT NULL,
PRIMARY KEY (CLIENTEID)
);

CREATE TABLE PRODUTO(
PRODUTOID              SERIAL         NOT NULL,
CATEGORIAPRODUTOID     INTEGER         NOT NULL,
DS_PRODUTO             VARCHAR(50)     NOT NULL,
OBS_PRODUTO            VARCHAR(300)    NOT NULL,
VL_VENDA_PRODUTO       NUMERIC(15,2)   NOT NULL,
DT_CADASTRO_PRODUTO    TIMESTAMP       NOT NULL,
STATUS_PRODUTO         VARCHAR(50)	   NOT NULL,
PRIMARY KEY(PRODUTOID),
FOREIGN KEY(CATEGORIAPRODUTOID) REFERENCES CATEGORIA_PRODUTO(CATEGORIAPRODUTOID)
);

CREATE TABLE ORCAMENTO(
ORCAMENTOID			   SERIAL		   NOT NULL,
CLIENTEID              INTEGER         NOT NULL,
DT_ORCAMENTO           TIMESTAMP       NOT NULL,
DT_VALIDADE_ORCAMENTO  TIMESTAMP       NOT NULL,
VL_TOTAL_ORCAMENTO     NUMERIC(15,2)   NOT NULL,
PRIMARY KEY(ORCAMENTOID),
FOREIGN KEY(CLIENTEID) REFERENCES CLIENTE(CLIENTEID)
);

CREATE TABLE ORCAMENTO_ITEM(
ORCAMENTOITEMID        SERIAL         NOT NULL,
ORCAMENTOID            INTEGER         NOT NULL,
PRODUTOID              INTEGER         NOT NULL,
QT_PRODUTO             NUMERIC(15,2)   NOT NULL,
VL_UNITARIO            NUMERIC(15,2)   NOT NULL,
VL_TOTAL               NUMERIC(15,2)   NOT NULL,
PRIMARY KEY (ORCAMENTOITEMID),
FOREIGN KEY(ORCAMENTOID) REFERENCES ORCAMENTO (ORCAMENTOID),
FOREIGN KEY(PRODUTOID) REFERENCES PRODUTO (PRODUTOID)
);

CREATE TABLE USUARIOS(
ID                     SERIAL     PRIMARY KEY,
USUARIO                VARCHAR(30),
NOME_COMPLETO          VARCHAR(60),
SENHA                  VARCHAR(50)
);


INSERT INTO CATEGORIA_PRODUTO(DS_CATEGORIA_PRODUTO)
VALUES
	('BASIC'),
	('PLATINUM'),
	('PREMIUM'),
	('ELITE');
-- SELECT * FROM  CATEGORIA_PRODUTO;


INSERT INTO CLIENTE (TIPO_CLIENTE, CPF_CNPJ_CLIENTE, NOME_CLIENTE) 
VALUES 
	('F', '943.051.830-56','JOSÉDASILVA'),
	('F', '802.202.930-07','PEDRODEOLIVEIRA'),
	('F', '637.502.500-14','MARIAEDUARDA MEIRELES'),
	('F', '997.192.890-66','SANDRAGOMES');

INSERT INTO PRODUTO (CATEGORIAPRODUTOID , DS_PRODUTO, OBS_PRODUTO,VL_VENDA_PRODUTO, DT_CADASTRO_PRODUTO, STATUS_PRODUTO) 
VALUES 
	(1,'CHAPAMETALICA','CHAPA GENERICA', 106.22,'18/02/2022','ATIVO'),
	(1,'FOLHAMETALICA','FOLHA GENERICA', 10.88,'18/02/2022','ATIVO'),
	(3,'CHAPADOURADA','CHAPA ESPECIFICA', 158.88,'18/02/2022','ATIVO'),
 	(4,'FOLHADIAMANTE','FOLHA UNICA', 665.33,'18/02/2022','ATIVO');
 
INSERT INTO ORCAMENTO (CLIENTEID, DT_ORCAMENTO, DT_VALIDADE_ORCAMENTO,VL_TOTAL_ORCAMENTO) 
VALUES 
	(1,'18/02/2022','19/02/2022', 10700.00),
 	(3,'17/02/2022','19/02/2022', 2700.00),
 	(4,'18/02/2022','19/02/2022', 1200.00),
	(2,'17/02/2022','19/02/2022', 8000.00);

-- SELECT * FROM CLIENTE

INSERT INTO ORCAMENTO_ITEM (ORCAMENTOID, PRODUTOID, QT_PRODUTO,VL_UNITARIO, VL_TOTAL) 
VALUES 
	(1, 1, 10, 100.00, 1000.00),
	(1, 2, 20, 10.00, 200.00),
	(1, 4, 30, 500.00, 1500.00),
 	(1, 3, 40, 200.00, 8000.00),
	(2, 1, 10, 100.00, 1000.00),
	(2, 2, 20, 10.00, 200.00),
	(2, 4, 30, 500.00, 1500.00),
	(3, 1, 10, 100.00, 1000.00),
	(3, 2, 20, 10.00, 200.00),
	(4, 3, 40, 200.00, 8000.00);
-- SELECT * FROM ORCAMENTO_ITEM

-- 1) Dados de produto com status ATIVO
SELECT * FROM PRODUTO WHERE STATUS_PRODUTO = 'ATIVO';

-- 2) Descrição do produto + descrição da categoria do produto
SELECT DS_PRODUTO AS "PRODUTO", DS_CATEGORIA_PRODUTO AS "CATEGORIA" FROM PRODUTO 
	JOIN CATEGORIA_PRODUTO ON PRODUTO.PRODUTOID =CATEGORIA_PRODUTO.CATEGORIAPRODUTOID;

-- 3) Dados de produtos onde o valor de venda é maior do que50,00.
SELECT * FROM PRODUTO WHERE VL_VENDA_PRODUTO > 50;

-- 4) Dados de orçamento + nome do cliente
SELECT ORCAMENTO.*, NOME_CLIENTE FROM ORCAMENTO
	JOIN CLIENTE ON ORCAMENTO.CLIENTEID = CLIENTE.CLIENTEID;

-- 5) Dados de item do orçamento + nome do produto + nomedacategoria.
SELECT ORCAMENTO_ITEM.*, DS_PRODUTO AS "PRODUTO", DS_CATEGORIA_PRODUTO AS "CATEGORIA"  FROM ORCAMENTO_ITEM 
	JOIN PRODUTO ON ORCAMENTO_ITEM.PRODUTOID = PRODUTO.PRODUTOID
	JOIN CATEGORIA_PRODUTO ON PRODUTO.PRODUTOID =CATEGORIA_PRODUTO.CATEGORIAPRODUTOID;

-- 6) Orçamentos feitos entre 01/02/2022 e 18/02/2022.
SELECT * FROM ORCAMENTO WHERE DT_ORCAMENTO BETWEEN '01/02/2022' AND '18/02/2022';

-- 7) Orçamentos vencidos (utilizando data atual CURRENT_DATE).
SELECT * FROM ORCAMENTO WHERE DT_VALIDADE_ORCAMENTO < CURRENT_DATE 

-- 8) Maior valor de item orçamento (por produto).
SELECT PRODUTOID, MAX(VL_UNITARIO) AS "PRODUTO MAIS CARO" FROM ORCAMENTO_ITEM
	GROUP BY PRODUTOID
	ORDER BY "PRODUTO MAIS CARO" DESC 
	LIMIT 1;

-- 9) Valor do item mais caro de todos os orçamentos.
SELECT ORCAMENTOID, MAX(VL_UNITARIO) AS "PRODUTO MAIS CARO" FROM ORCAMENTO_ITEM
	GROUP BY ORCAMENTOID
	ORDER BY ORCAMENTOID asc;

-- 10) Soma do valor de todos orçamentos.
SELECT SUM(VL_TOTAL_ORCAMENTO) AS "SOMA TOTAL DE ORÇAMENTOS" FROM ORCAMENTO

-- 11) Quantidade total de itens (por orçamento)
SELECT ORCAMENTOID, COUNT(PRODUTOID) AS "QTD DE PRODUTOS" FROM ORCAMENTO_ITEM
	GROUP BY ORCAMENTOID
	ORDER BY ORCAMENTOID asc;

